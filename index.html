async function spin() {
  if (isSpinning || balance < bet) return;
  isSpinning = true;
  message.textContent = "";

  // Убираем мигание
  document.querySelectorAll(".cell").forEach(cell => {
    cell.classList.remove("flash");
  });

  balance -= bet;
  pot += bet;
  updateInfo();

  setTimeout(() => playBeep(0.1), 1);

  const fallSpeed = 120;  // Скорость падения (чем больше, тем медленнее)
  const totalSpinDuration = 8000;  // Общее время вращения (в миллисекундах)
  const spins = Math.floor(totalSpinDuration / fallSpeed);  // Число шагов

  const columnTasks = [];

  for (let col = 0; col < cols; col++) {
    columnTasks.push((async () => {
      await new Promise(res => setTimeout(res, col * 100));  // Легкое сдвижение начала

      for (let i = 0; i < spins; i++) {
        for (let row = rows - 1; row > 0; row--) {
          currentGrid[col][row] = currentGrid[col][row - 1];
        }
        currentGrid[col][0] = symbols[Math.floor(Math.random() * symbols.length)];

        createGridDisplay();  // Обновляем отображение
        await new Promise(res => setTimeout(res, fallSpeed));  // Пауза между падениями
      }
    })());
  }

  await Promise.all(columnTasks);
  createGridDisplay();
  checkWins();
  isSpinning = false;
}
